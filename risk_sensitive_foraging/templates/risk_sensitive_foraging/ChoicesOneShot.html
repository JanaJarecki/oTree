{% extends "risk_sensitive_foraging/Page.html" %}
{% load otree static %}
{% load i18n %}

{% block title %}
{% endblock %}

{% block content %}
  <div class='dialogue round-edge center-me-h'>
    <div class = 'center-me-hv fs2'>
      <p>{% blocktrans trimmed %}
      Neue Situation
      {% endblocktrans %}</p>
    </div>
  </div>
  <div class = "row1 parent center-children">
    <div class = 'center-children flex-row-flex-start center-me-h'>
      <div class = "chart-icon"><i class="far fa-2x fa-clock center-me-v"></i></div>
      <div class="chart-trial" id = "chart-trial"></div>
    </div>
  </div>

  <div class = "row parent center-children">
    <div class = 'center-children flex-row-flex-start center-me-h'>
      <div class = "chart-icon"><i class="fas fa-signal fa-2x center-me-v"></i></div>
      <div class="chart-earnings" id="chart-earnings"></div>
    </div>
  </div>

  <div class = "row parent flex-row">
    <button name="choice1" value="0" class="option rsft-btn-choices">
      <span class = "rsft-span-choices">
        <div class = "{{ img1 }}" id = "option1">
        </div>
      </span>
    </button>
      
    <button name="choice1" value="1" class="option rsft-btn-choices">
      <span class = "rsft-span-choices">
        <div class = "{{ img2 }}" id = "option2">
        </div>
      </span>
    </button>
  </div>
  </div>

  <div class = 'hidden'>
    {% next_button %}
    {% for field in form %}
      {% formfield field %}
    {% endfor %}
  </div>

{% endblock %}

{% block scripts %}
  <script>
  
  var trial = {{ trial }};
  $('.option').attr('name', 'choice' + trial );
  var state = {{ state }};
  var start = 0;
  var end = 0;

  $('.rsft-btn-choices').click(function() {
    end = window.performance.now();
    $('#id_rt_ms' + (trial)).val(end - start);
    var choice = $(this).val();
    $('#id_choice' +trial).val(choice);
    $('#id_state'  +trial).val(state);
    $('.otree-btn-next').click();
    });


  var draw = function() {
    drawTrial('chart-trial', true, {{ trial }}, {{ Constants.num_trials }}, '');
    drawEarnings('chart-earnings', {{ player.state|json }}, {{ player.budget|json }}, {{ max_less_state|json }}, {{ max_earning|json }}, true, true, {{ Constants.point_label|json }});
  }

  $( document ).ready( function() {
    setTimeout(draw, 1000);
    $('.dialogue').fadeIn(1000).fadeOut(500);
  });
  </script>
{% endblock %}
